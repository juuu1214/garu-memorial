{% extends "_base.html" %}
{% block content %}

<style>
  :root {
    --fg:#0f1a14; --muted:#666; --line:#e7ece9; --chip:#cfd8d3; --chip2:#bfcdc4;
  }

  .admin-wrap { max-width:880px; margin:0 auto; padding:16px; }
  .admin-head { display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
  .admin-title { font-weight:700; font-size:20px; }

  .admin-actions { display:flex; gap:8px; flex-wrap:wrap; width:100%; }
  @media (min-width:520px){ .admin-actions{ width:auto; } }

  .btn-chip{
    display:inline-flex; align-items:center; justify-content:center; gap:6px;
    padding:12px 14px; border:1px solid var(--chip); border-radius:999px;
    font-size:15px; background:#fff; color:var(--fg); text-decoration:none; transition:.2s ease;
    min-height:44px; /* 터치 타겟 */
  }
  .btn-chip:hover{ background:var(--chip); color:#fff; }
  .btn-chip:active{ transform:translateY(1px); }

  .divider{ height:1px; background:var(--line); margin:12px 0 16px; }

  /* 폼: 모바일에선 세로 스택 */
  .form-row{ display:flex; gap:8px; align-items:center; }
  .form-row input[type="password"],
  .form-row input[type="file"]{
    flex:1; border:1px solid var(--chip2); border-radius:10px; padding:12px 12px; font-size:15px;
    min-height:44px;
  }
  .form-row .btn-chip{ flex:0 0 auto; }

  @media (max-width:520px){
    .admin-title{ font-size:18px; }
    .form-row{ flex-direction:column; align-items:stretch; }
    .form-row .btn-chip{ width:100%; }
  }

  /* 썸네일 그리드 */
  .thumb-grid{
    display:grid; grid-template-columns:repeat(2, 1fr); gap:10px;
  }
  @media (min-width:680px){
    .thumb-grid{ grid-template-columns: repeat(auto-fill, minmax(160px,1fr)); }
  }
  @media (max-width:360px){
    .thumb-grid{ grid-template-columns:1fr; }
  }

  .thumb{
    position:relative; aspect-ratio:1/1; overflow:hidden; border-radius:12px; background:#f7f9f8;
    border:1px solid var(--line);
  }
  .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .thumb .thumb-actions{
    position:absolute; left:8px; right:8px; bottom:8px;
    display:flex; gap:6px; justify-content:space-between;
  }
  .thumb .thumb-actions .btn-chip{ padding:8px 10px; font-size:13px; min-height:36px; }

  .flash{
    margin:8px 0 0; padding:10px 12px; border-radius:10px; background:#f0f7f4; border:1px solid #cfe3d9;
    font-size:13px;
  }
</style>

<div class="admin-wrap">
  <div class="admin-head">
    <div class="admin-title">관리자 페이지</div>
    <div class="admin-actions">
      <a class="btn-chip" href="{{ url_for('index') }}">🏠 메인</a>
      <a class="btn-chip" href="{{ url_for('gallery') }}">📸 사진첩</a>
      <a class="btn-chip" href="{{ url_for('guest_list') }}">📝 방명록</a>
    </div>
  </div>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="flash">
        {% for m in messages %}
          <div>{{ m }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="divider"></div>

  {% if not session.get('is_admin') %}
    <!-- 로그인 폼 -->
    <form class="form-row" action="{{ url_for('admin_login') }}" method="post">
      <input type="password" name="password" placeholder="관리자 비밀번호" required>
      <button class="btn-chip" type="submit">🔒 로그인</button>
    </form>
  {% else %}
    <!-- 로그아웃 -->
    <form action="{{ url_for('admin_logout') }}" method="post" style="margin-bottom:12px;">
      <button class="btn-chip" type="submit">🔓 로그아웃</button>
    </form>

    <!-- 메인 사진 교체 -->
    <h3 style="margin:6px 0 8px;">메인 페이지 사진 변경</h3>
    <form class="form-row" action="{{ url_for('admin_main_photo') }}" method="post" enctype="multipart/form-data">
      <input type="file" name="photo" accept="image/*" required>
      <button class="btn-chip" type="submit">📷 교체</button>
    </form>

    <div class="divider"></div>

    <!-- 사진 업로드 -->
    <h3 style="margin:0 0 8px;">사진첩 사진 업로드</h3>
    <form class="form-row" action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data">
      <input type="file" name="photo" accept="image/*" required>
      <button class="btn-chip" type="submit">📤 업로드</button>
    </form>

    <div class="divider"></div>

    <!-- 업로드된 사진 목록 + 삭제 -->
    <h3 style="margin:0 0 8px;">업로드된 사진 관리</h3>
    {% if images and images|length > 0 %}
      <div class="thumb-grid">
        {% for img in images %}
          <div class="thumb">
            <img src="{{ img.url }}" alt="{{ img.name }}">
            <div class="thumb-actions">
              <a class="btn-chip" href="{{ img.url }}" target="_blank">보기</a>
              <form action="{{ url_for('admin_gallery_delete') }}" method="post" onsubmit="return confirm('정말 삭제할까요?');">
                <input type="hidden" name="filename" value="{{ img.name }}">
                <button class="btn-chip" type="submit">🗑️ 삭제</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div style="opacity:.7;">아직 업로드된 사진이 없습니다.</div>
    {% endif %}
  {% endif %}
</div>

{% endblock %}